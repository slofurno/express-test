<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}
body {
	font-size:100%;
	margin: 0 auto;
    min-height: 100%;
    max-width: 1000px;
}

input {
    width:100%;
}



</style>
<body>
    <div style="width:360px; 
			margin:0 auto; 
			padding: 20px;
			background-color:gainsboro">

        <input id="password" type="text" name="password" placeholder="password"/>
        <input id="submit" type="button" value="submit"/>

    </div>
<p>
</p>
<script>
function mapQueryString(s){
      return s.split('&')
  .map(function(kvp){
        return kvp.split('=');
  }).reduce(function(sum,current){
        var key = current[0];
        var value = decodeURIComponent(current[1]);
        sum[key] = value;
        return sum;
  },{});
}

var qs = mapQueryString(location.search.substr(1));

function request (method, url, body)
{
	body = body || "";
	return new Promise((resolve, reject) => {
		var client = new XMLHttpRequest();
		client.onload = function (e) {
			if (client.status !== 200) reject(client.statusText);

			resolve(client.response);
		};
		client.open (method, url);
		client.send (body);
	});
}

document.getElementById("submit").onclick = function(e) {
	var password = document.getElementById("password").value;	
    var expire = parseInt(qs.expire);

	var body = {
		email:qs.email,
		expire:expire,
		hash:qs.hash,
		password:password
	};

	request("POST", "/api/reset", JSON.stringify(body))
        .then(x => {
            console.log("SUCCESS password reset");
            location.assign("/login.html");    
        })
		.catch(console.error);

};

</script>
</body>
</html>

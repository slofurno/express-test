<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}
body {
	font-size:100%;
	margin: 0 auto;
    min-height: 100%;
    max-width: 1000px;
}

input {
    width:100%;
}

</style>
<body>
    <div id="content" style="width:360px; 
			margin:0 auto; 
			padding: 20px;
			background-color:gainsboro">

        <input id="email" type="text" name="email" placeholder="email"/>
        <input id="password" type="text" name="password" placeholder="password"/>
        <input id="create" type="button" value="create account"/>
        <input id="login" type="button" value="login"/>
        <a id="forgot" href="#">generate password reset link</a><br>

    </div>

<p>
</p>
<script>
function mapQueryString(s){
      return s.split('&')
  .map(function(kvp){
        return kvp.split('=');
  }).reduce(function(sum,current){
        var key = current[0];
        var value = decodeURIComponent(current[1]);
        sum[key] = value;
        return sum;
  },{});
}

var qs = mapQueryString(location.search.substr(1));

function request (method, url, body)
{
	body = body || "";
	return new Promise((resolve, reject) => {
		var client = new XMLHttpRequest();
		client.onload = function (e) {
			if (client.status !== 200) reject(client.statusText);

			resolve(client.response);
		};
		client.open (method, url);
		client.send (body);
	});
}


document.getElementById("forgot").onclick = function(e) {
    e.preventDefault();

	var email = document.getElementById("email").value;	
	var password = document.getElementById("password").value;	

	var body = {
        email,
        password
	};

    request("POST", "/api/forgot", JSON.stringify(body))
        .then(q => {
            var el = document.createElement("a");    
            var link = "/forgot.html?"+q;
            
            el.href = link;
            el.innerHTML = link;
            el.style.whiteSpace = "nowrap";
            el.style.display = "block";
            content.appendChild(el);
        });

};

document.getElementById("login").onclick = function(e) {
	var email = document.getElementById("email").value;	
	var password = document.getElementById("password").value;	

	var body = {
        email,
        password
	};

	request("POST", "/api/login", JSON.stringify(body))
        .then(x => {
            console.log("SUCCESS login:", x);
        })
        .catch(err => {
            console.error(err);
        });
};

document.getElementById("create").onclick = function(e) {
	var email = document.getElementById("email").value;	
	var password = document.getElementById("password").value;	
	var content = document.getElementById("content");	

	var body = {
        email,
        password
	};

	request("POST", "/api/account", JSON.stringify(body))
        .then(x => {
            console.log("SUCCESS created account:", email);
        })
		.catch(console.error);

};

</script>
</body>
</html>
